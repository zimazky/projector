# План внедрения явного внедрения зависимостей с использованием React Context

## Введение

Этот план описывает шаги по дальнейшему внедрению явного внедрения зависимостей в приложение Projector, используя React Context. Цель состоит в том, чтобы перейти от импорта глобальных синглтонов хранилищ к предоставлению их через React Context, что улучшит тестируемость, гибкость и соответствие современным идиомам React.

## Текущее состояние

На данный момент все экземпляры хранилищ и сервисов инстанцируются в файле `src/root.ts` и затем импортируются напрямую в компоненты или другие сервисы/хранилища. Некоторые хранилища и сервисы уже получают свои зависимости через конструктор.

## 1. Создание контекста хранилищ (`StoreContext`)

*   **Действие:** Создать React Context для хранения всех экземпляров хранилищ и сервисов.
*   **Подробности:**
    *   Создать файл `src/contexts/StoreContext.ts`.
    *   Определить интерфейс или тип для объекта контекста, который будет содержать все необходимые хранилища (например, `mainStore`, `uiStore`, `projectsStore`, `eventsStore`, `googleApiService`, `storageService` и т.д.).
    *   Создать `React.createContext` с этим типом.

## 2. Создание компонента провайдера хранилищ (`StoreProvider`)

*   **Действие:** Создать React компонент, который будет предоставлять экземпляры хранилищ через созданный `StoreContext`.
*   **Подробности:**
    *   Создать файл `src/components/StoreProvider.tsx`.
    *   Этот компонент будет получать все экземпляры хранилищ/сервисов в качестве пропсов.
    *   Он будет использовать `StoreContext.Provider`, передавая ему объект со всеми экземплярами хранилищ в качестве значения (`value`).
    *   Внутри `StoreProvider` будут рендериться `props.children`.

## 3. Обновление `src/index.tsx` (Корневой провайдер)

*   **Действие:** Модифицировать корневой файл приложения для использования `StoreProvider`.
*   **Подробности:**
    *   В `src/index.tsx` импортировать все экземпляры хранилищ и сервисов из `src/root.ts`.
    *   Импортировать компонент `StoreProvider`.
    *   Обернуть основной компонент `<App />` в `<StoreProvider>`, передавая все импортированные экземпляры хранилищ/сервисов в качестве пропсов.

## 4. Обновление компонентов для использования `useContext`

*   **Действие:** Рефакторинг всех компонентов, которые в настоящее время импортируют экземпляры хранилищ напрямую из `src/root.ts`, для использования хука `useContext`.
*   **Подробности:**
    *   Идентифицировать все компоненты, импортирующие хранилища из `src/root.ts`.
    *   В каждом таком компоненте:
        *   Удалить прямые импорты хранилищ из `src/root.ts`.
        *   Импортировать `useContext` из React и `StoreContext` из `src/contexts/StoreContext.ts`.
        *   Получать необходимые экземпляры хранилищ с помощью `const { storeName } = useContext(StoreContext);`.
*   **Пример:**
    ```typescript
    // Было:
    // import { uiStore } from 'src/root'
    // const MyComponent: React.FC = observer(() => {
    //   // ... uiStore.viewMode ...
    // })

    // Станет:
    import React, { useContext } from 'react'
    import { observer } from 'mobx-react-lite'
    import { StoreContext } from 'src/contexts/StoreContext'

    const MyComponent: React.FC = observer(() => {
      const { uiStore } = useContext(StoreContext)
      // ... uiStore.viewMode ...
    })
    ```

## 5. Проверка

*   После каждого этапа убедиться, что приложение продолжает работать без ошибок.
*   Компиляция проекта (`npm run build`).
*   Визуальная проверка функциональности.

## Преимущества

*   **Улучшенная тестируемость:** Компоненты становятся легче тестировать, так как их зависимости могут быть легко замокированы (mocked) путем предоставления различных экземпляров хранилищ через контекст в тестовой среде.
*   **Более явные зависимости:** Зависимости компонентов становятся более очевидными, поскольку они запрашиваются из контекста, а не неявно импортируются как глобальные синглтоны.
*   **Большая гибкость:** Позволяет легко изменять или подменять реализации хранилищ или сервисов (например, для A/B-тестирования или различных сред).
*   **Соответствие идиомам React:** Использование React Context является стандартным способом передачи данных глубоко по дереву компонентов.
*   **Улучшенная композиция:** Способствует созданию более чистых и переиспользуемых компонентов.

Этот план обеспечит поэтапный подход к переходу на более явное внедрение зависимостей, что сделает архитектуру приложения более надежной и гибкой.
