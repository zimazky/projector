# Анализ архитектуры проекта на соответствие Feature-Sliced Design (FSD)

## Введение

Цель этого документа — оценить текущую архитектуру проекта `projector` на предмет соответствия принципам Feature-Sliced Design (FSD) и предложить конкретные рекомендации по оптимизации структуры для лучшего следования этой методологии.

## Текущая структура проекта и ее соответствие FSD

Проект `projector` уже демонстрирует сильную ориентацию на FSD, используя именованные папки для слоев: `1-app`, `3-pages`, `4-widgets`, `5-features`, `6-entities`, `7-shared`. Это очень хороший старт и указывает на то, что команда уже знакома с принципами FSD.

Рассмотрим соответствие каждого слоя:

1.  **`1-app`**: Содержит `App/App.tsx`. Это полностью соответствует слою `app`, который является точкой входа и содержит глобальную логику/компоненты приложения.
2.  **`3-pages`**: Содержит `Calendar`, `DayList`, `Projects`. Это типичное содержимое для слоя `pages`, представляющего собой страницы приложения.
3.  **`4-widgets`**: Содержит `DriveFilePicker`, `EventForm`, `Header`. Это также хорошо соответствует слою `widgets`, который объединяет фичи и сущности для формирования осмысленных блоков UI.
4.  **`5-features`**: Содержит `CalendarIconBar`, `YesCancelConfirmation`. Эти компоненты, по всей видимости, представляют собой конкретные пользовательские сценарии или интерактивные элементы, что соответствует слою `features`.
5.  **`6-entities`**: Содержит папку `stores` и внутри нее `MainStore.ts`, а также папки для `Calendar`, `DayListStore`, `DrivePicker`, `EventForm`, `Events`, `EventsCache`, `Locations`, `Projects`, `UIStore`, `Weather`.
    *   Часть содержимого (`Events`, `Locations`, `Projects`, `Weather`) очень хорошо соответствует `entities` — это чистые бизнес-сущности.
    *   Однако наличие `CalendarStore`, `DayListStore`, `DrivePickerStore`, `EventFormStore`, `UIStore` непосредственно здесь может быть отклонением. FSD предполагает, что `entities` содержат только описание самих сущностей и базовые операции с ними, а логика их обработки, специфичная для конкретного UI-компонента (страницы, виджета, фичи), должна находиться в соответствующих слайсах этих компонентов. `MainStore` также вызывает вопросы — это может быть глобальный стор, но часто такие сторы имеют тенденцию накапливать слишком много разнородной логики.
6.  **`7-shared`**: Содержит `helpers`, `hooks`, `libs`, `model/accounts`, `services`, `types`, `ui`.
    *   Большая часть содержимого (`helpers`, `hooks`, `libs`, `services`, `types`, `ui`) идеально соответствует слою `shared` — это переиспользуемый, атомарный код, не имеющий отношения к конкретной бизнес-логике.
    *   Папка `model/accounts` вызывает вопросы. Если `Accounts` — это core-бизнес-сущность приложения (например, модель пользователя или учетной записи), то ее место, скорее всего, в `6-entities`. Если же это очень низкоуровневая, абстрактная модель, используемая по всему приложению без прямого отношения к конкретным бизнес-процессам, то ее размещение здесь может быть оправдано, но требует более глубокого изучения.

## Рекомендации по оптимизации структуры

Для полного соответствия FSD и повышения чистоты архитектуры предлагаю следующие шаги:

1.  **Удалить числовые префиксы у папок слоев:**
    *   Переименовать `1-app` в `app`
    *   Переименовать `3-pages` в `pages`
    *   Переименовать `4-widgets` в `widgets`
    *   Переименовать `5-features` в `features`
    *   Переименовать `6-entities` в `entities`
    *   Переименовать `7-shared` в `shared`
    *   *Обоснование:* Числовые префиксы не являются частью стандартной нотации FSD. Порядок слоев регулируется правилами импортов (слои выше не могут импортировать из слоев ниже) и алиасами в `tsconfig.json`/Webpack-конфигурации.

2.  **Рефакторинг `6-entities/stores`:**
    *   **Переместить сторы, специфичные для UI-компонентов:**
        *   `CalendarStore.ts` вероятно, должен быть перемещен в `pages/Calendar/model/CalendarStore.ts` или `widgets/CalendarWidget/model/CalendarStore.ts` (в зависимости от того, является ли `Calendar` страницей или виджетом). То же касается `DayListStore.ts`, `DrivePickerStore.ts`, `EventFormStore.ts`, `UIStore.ts`.
        *   В FSD сторы, которые управляют состоянием конкретного виджета, страницы или фичи, должны находиться внутри слайса этого виджета/страницы/фичи. Это повышает связность и снижает зацепление.
    *   **Пересмотреть `MainStore.ts`:** Если `MainStore` содержит глобальное состояние, которое действительно необходимо всему приложению, его можно оставить в `app/model/MainStore.ts`. Однако рекомендуется провести декомпозицию `MainStore`, чтобы избежать "god object" антипаттерна. Глобальное состояние часто может быть распределено по более мелким и специализированным сторам.

3.  **Пересмотреть `7-shared/model/accounts`:**
    *   Если `Accounts` является ключевой бизнес-сущностью, активно участвующей в бизнес-логике приложения (например, как `Events` или `Projects`), ее следует переместить в `entities/accounts`.
    *   *Пример:* `entities/accounts/AccountsModel.ts`, `entities/accounts/AccountsStore.ts`, `entities/accounts/types.ts`.
    *   Если же `accounts` представляет собой крайне общие утилиты для работы с учетными записями, которые используются как "сервисы" без привязки к конкретным бизнес-процессам, тогда `shared` может быть приемлемым, но это исключение.

4.  **Соблюдение правил зависимостей FSD:**
    *   Провести аудит импортов на предмет нарушения правил FSD (например, слой `entities` не должен импортировать из `features`, `widgets` или `pages`).
    *   Рекомендуется настроить линтер (например, ESLint с плагином `eslint-plugin-import-helpers` или кастомными правилами) для автоматической проверки и предотвращения нарушений правил слоев FSD.

## Заключение

Ваш проект `projector` уже следует основной идее FSD, что является большим плюсом для его масштабируемости и поддерживаемости. Предложенные рекомендации направлены на устранение небольших несоответствий, в основном связанных с размещением MobX-сторов и разделением на бизнес-сущности и UI-специфичную логику. Реализация этих изменений позволит еще больше укрепить архитектуру проекта и сделать ее более предсказуемой и легко развиваемой.
