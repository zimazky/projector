(()=>{"use strict";class e{static WEEKDAYS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];static MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];static MONTHS_FULL=["January","February","March","April","May","June","July","August","September","October","November","December"];static startWeek=1;static timezone=3;static initLocale(t=3,a=1){e.timezone=t,e.startWeek=a}static getDayMonthWeekday(e){const t=new Date(1e3*e);return{day:t.getDate(),month:t.getMonth(),weekday:t.getDay()}}static getWeekday(e){return new Date(1e3*e).getDay()}static getBegintWeekTimestamp(t){const a=new Date(1e3*t);a.setHours(0,0,0,0);const n=a.getDate();let c=a.getDay()-e.startWeek;return c<0&&(c+=7),a.setDate(n-c)/1e3}static getBeginDayTimestamp=e=>new Date(1e3*e).setHours(0,0,0,0)/1e3;static getEndDayTimestamp=t=>86400*~~((t+3600*e.timezone)/86400)-3600*e.timezone+86399;static getTime=t=>t-e.getBeginDayTimestamp(t);static getTimeToEndDay=t=>e.getBeginDayTimestamp(t)+86399-t;static getDifferenceInDays=(t,a)=>(e.getBeginDayTimestamp(a)-e.getBeginDayTimestamp(t))/86400;static getTimeString(e){const t=new Date(1e3*e),a=t.getUTCHours(),n=t.getUTCMinutes();return a+(n>9?":":":0")+n}static getYYYYMMDD(e){const t=new Date(1e3*e),a=t.getFullYear(),n=t.getMonth()+1,c=t.getDate();return a+(n>9?"-":"-0")+n+(c>9?"-":"-0")+c}static getHHMM(e){const t=new Date(1e3*e),a=t.getHours(),n=t.getMinutes();return(a>9?"":"0")+a+(n>9?":":":0")+n}static getYYYYMMDDTHHMM(e){const t=new Date(1e3*e),a=t.getFullYear(),n=t.getMonth()+1,c=t.getDate(),r=t.getHours(),s=t.getMinutes();return a+(n>9?"-":"-0")+n+(c>9?"-":"-0")+c+(r>9?"T":"T0")+r+(s>9?":":":0")+s}}function t({timestamp:t,dayHeight:a,actualBalance:n,plannedBalance:c,plannedBalanceChange:r,onAddEvent:s=(()=>{}),children:i=null}){const l=React.useRef(null),{day:d,month:m}=e.getDayMonthWeekday(t),o=e=>(e/1e3).toFixed(1);return React.createElement("div",{className:"CalendarDay_afb7130",style:{height:a},onClick:function(e){l&&l.current.focus()}},React.createElement("div",{className:"CalendarDayHeader_ce37fdc"},d+(1==d?" "+e.MONTHS[m]:"")),React.createElement("div",{className:"balance_c271232"},React.createElement("span",{className:"plannedBalance_dee8e33"},o(c)+(0==r?"k":((u=r/1e3)>0?"+"+u.toFixed(1):u.toFixed(1))+"k"))," ",React.createElement("span",{className:"actualBalance_c28974d"},o(n))),React.createElement("div",{className:"CalendarDayTasks"}," ",i," "),React.createElement("div",{className:"DayTaskInput_c3fce47"},React.createElement("input",{ref:l,rows:1,wrap:"off",onBlur:function(e){s(t,e.target.value),e.target.value=""},onKeyDown:function(e){13===e.keyCode&&e.target.blur()}})));var u}function a({id:t,name:a,days:n,time:c=0,completed:r=!1,onClick:s=((e,t)=>{})}){return React.createElement("div",{className:"EventItem_b1f2ae7",style:{width:1==n?"calc(100% + 2px)":"calc("+n+" * (100% + 1px) + 1px )"},onClick:e=>{e.stopPropagation(),s(t,r)}},r&&React.createElement("div",{className:"event_item_completed_f843140"}),React.createElement("div",{className:"event_row_c1f0c4e"},React.createElement("div",{className:"complete_button_a23d2b0"},r?"✔":"☐"),React.createElement("span",null,a),React.createElement("span",{className:"EventTime_f0aa565"},e.getTimeString(c))))}function n(){return React.createElement("div",{className:"EventPlaceholder_b109d15"})}function c(e,t,a=31,n=1){const[c,r=null]=t.split("-",2);if(null===r){const[c,r=null]=t.split("/",2);if(""===c||""===r)return e;const s="*"===c?n:+c;let i=+r;if(isNaN(s)||isNaN(i))return e;if(null===r&&"*"!==c)return e.push(+c),e;0===i&&(i=1);for(let t=s;t<=a;t+=i)e.push(t);return e}if(""===c||""===r)return e;for(let t=+c;t<=+r;t++)e.push(t);return e}class r{static getStartDay=t=>e.getBeginDayTimestamp(t.start);static getStartTime=t=>e.getTime(t.start);static getEnd=t=>void 0!==t.end?t.end:void 0!==t.duration?t.start+60*t.duration:e.getEndDayTimestamp(t.start);static getEndDayOfEnd=t=>e.getEndDayTimestamp(r.getEnd(t));static getDuration=t=>void 0!==t.end?t.end-t.start:void 0!==t.duration?60*t.duration:e.getTimeToEndDay(t.start);static getDurationInDays=t=>{const a=void 0!==t.end?(e.getEndDayTimestamp(t.end)-e.getBeginDayTimestamp(t.start))/86400:void 0!==t.duration?(e.getEndDayTimestamp(t.start+60*t.duration)-e.getBeginDayTimestamp(t.start))/86400:1;return Math.ceil(a)};static isRepeatable=e=>void 0!==e.repeat;static isIncludes=(e,t)=>t>=r.getStartDay(e)&&t<r.getEndDayOfEnd(e);static toPlannedEventItem=(e,t,a)=>({id:e,name:t.name,time:r.getStartTime(t),days:a,debit:t.debit??0,credit:t.credit??0});static toActualEventItem=(e,t,a)=>({id:e,name:t.name,time:r.getStartTime(t),days:a,debit:t.debit??0,credit:t.credit??0})}const s=e=>new Date(1e3*e).toLocaleString(),i=(t,a)=>({id:t.id,name:t.name,start:t.start,end:t.end,days:e.getDifferenceInDays(a,t.end)+1,credit:t.credit,debit:t.debit,completed:t.completed}),l=[{name:"НО +30000",credit:52683,comment:"начальный остаток",start:new Date("2022-01-01 00:00")/1e3}],d=[{name:"ЗП +40020",credit:40020,repeat:"10,25 * *",start:new Date("2021-12-01 10:00")/1e3,duration:20},{name:"пенсия мамы",credit:31e3,repeat:"17",start:new Date("2021-12-01 09:00")/1e3,duration:20},{name:"заправка",debit:2500,repeat:"/6",start:new Date("2022-01-12 15:00")/1e3,duration:30},{name:"купить продукты",debit:8e3,repeat:"* * 0",start:new Date("2022-01-04 15:00")/1e3,duration:80},{name:"маму на укол",debit:4e4,start:new Date("2022-02-05 18:00")/1e3,duration:80},{name:"тест2",debit:0,start:new Date("2022-02-05 20:00")/1e3,duration:80},{name:"четные",repeat:"2/2",repeatEnd:new Date("2022-01-16 1:30")/1e3,start:new Date("2021-11-01 01:00")/1e3,duration:0},{name:"комплексные",repeat:"1/3,20-25",start:new Date("2021-11-01 01:00")/1e3,duration:0},{name:"дорога на работу",cost:0,repeat:"* * 1-5",start:new Date("2021-11-01 08:00")/1e3,duration:60},{name:"работа",cost:0,repeat:"* * 1-5",start:new Date("2021-11-01 09:00")/1e3,duration:540},{name:"праздники",cost:0,start:new Date("2021-12-31 00:00")/1e3,end:new Date("2022-01-19 23:59")/1e3},{name:"test",cost:0,start:new Date("2022-01-14 14:00")/1e3,duration:2039},{name:"отпуск",cost:0,start:new Date("2022-01-07 00:00")/1e3,duration:20159}],m=new class{constructor(t,a){this.cachedPlannedEvents=[],this.cachedCompletedEvents=[],this.cachedActualBalance=[],this.cachedPlannedBalance=[],this.lastId=1,this.completed=t.map((t=>({id:this.lastId++,name:t.name,comment:t.comment??"",start:t.start,startDay:e.getBeginDayTimestamp(t.start),end:r.getEnd(t),days:r.getDurationInDays(t),credit:t.credit??0,debit:t.debit??0,completed:!0}))),this.planned=[],this.plannedRepeatable=[],a.forEach((t=>{t.repeat?this.plannedRepeatable.push({id:this.lastId++,name:t.name,comment:t.comment??"",repeat:t.repeat,repeatStart:t.start,repeatStartDay:e.getBeginDayTimestamp(t.start),time:e.getTime(t.start),duration:t.duration?60*t.duration:e.getTimeToEndDay(t.start),repeatEnd:t.repeatEnd??null,days:1,credit:t.credit??0,debit:t.debit??0,completed:!1}):this.planned.push({id:this.lastId++,name:t.name,comment:t.comment??"",start:t.start,startDay:e.getBeginDayTimestamp(t.start),end:r.getEnd(t),days:r.getDurationInDays(t),credit:t.credit??0,debit:t.debit??0,completed:!1})})),this.sort(),this.lastActualBalance=this.calculateActualBalance(),this.lastActualBalanceDate=this.completed[this.completed.length-1].startDay,this.firstActualBalanceDate=this.completed[0].startDay}sort(){this.completed.sort(((e,t)=>{const a=e.start-t.start;return 0===a?t.days-e.days:a})),this.planned.sort(((e,t)=>{const a=e.start-t.start;return 0===a?t.days-e.days:a})),this.plannedRepeatable.sort(((e,t)=>e.time-t.time))}calculateActualBalance(){return this.completed.reduce(((e,t)=>e+(t.credit-t.debit)),0)}getPlannedEvents(t){if(void 0!==this.cachedPlannedEvents[t])return this.cachedPlannedEvents[t];const a=this.planned.reduce(((a,n)=>(t<n.startDay||t>=e.getEndDayTimestamp(n.end)||a.push(i(n,t)),a)),[]);return this.plannedRepeatable.reduce(((a,n)=>(t<n.repeatStartDay||n.repeatEnd&&t+n.time>=n.repeatEnd||class{static isMatch(t,a,n){const{day:r,month:s,weekday:i}=e.getDayMonthWeekday(n),[l=null,d="*",m="*"]=t.trim().split(" ",3);if(null===l)return!1;if("/"===l[0]){const t=~~((n-e.getBeginDayTimestamp(a))/86400);return!(t<0)&&t%+l.substring(1)==0}const o=l.split(",").reduce(((e,t)=>c(e,t)),[]),u=d.split(",").reduce(((e,t)=>c(e,t,12)),[]),p=m.split(",").reduce(((e,t)=>c(e,t,7,0)),[]);return!!(u.includes(s+1)&&o.includes(r)&&p.includes(i))}}.isMatch(n.repeat,n.repeatStartDay,t)&&a.push(i(((t,a,n)=>{const c=n+a.time;return{id:t,name:a.name,comment:a.comment,start:c,startDay:e.getBeginDayTimestamp(c),end:c+a.duration,days:1,credit:a.credit,debit:a.debit,completed:a.completed}})(n.id,n,t),t)),a)),a),this.cachedPlannedEvents[t]=a,a}getCompletedEvents(t){if(void 0!==this.cachedCompletedEvents[t])return this.cachedCompletedEvents[t];const a=this.completed.reduce(((a,n)=>(t>=n.startDay&&t<e.getEndDayTimestamp(n.start)&&a.push(i(n,t)),a)),[]);return this.cachedCompletedEvents[t]=a,a}getEventsWithPlaceholders(e,t=[],a=[]){for(;t.length>0&&!(e<t[t.length-1].end);)t.pop();return t.forEach((e=>a.push({id:-1}))),this.getPlannedEvents(e).reduce(((e,a)=>(t.some((e=>a.id===e.id))||(a.days>1&&t.push({id:a.id,end:a.end}),e.push(a)),e)),a),this.getCompletedEvents(e).reduce(((e,t)=>(e.push(t),e)),a),a}getPlannedEventsFilteredBySkip(e,t=[],a=[]){for(;t.length>0&&!(e<t[t.length-1].end);)t.pop();this.getPlannedEvents(e).reduce(((e,a)=>(t.some((e=>a.id===e.id))||(a.days>1&&t.push({id:a.id,end:a.end}),e.push(a)),e)),a)}getPlannedEventsInInterval(e,t){const a=[],n=[];for(let c=e;c<t;c+=86400)this.getPlannedEventsFilteredBySkip(c,n,a);return a}getActualBalance(e){if(e<this.firstActualBalanceDate)return 0;if(e>=this.lastActualBalanceDate)return this.lastActualBalance;if(void 0!==this.cachedActualBalance[e])return this.cachedActualBalance[e];const t=this.completed.reduce(((t,a)=>(e>=a.start&&(t+=a.credit-a.debit),t)),0);return this.cachedActualBalance[e]=t,t}getPlannedBalance(e){if(e<this.firstActualBalanceDate)return 0;if(e<this.lastActualBalanceDate)return this.getActualBalance(e);if(void 0!==this.cachedPlannedBalance[e])return this.cachedPlannedBalance[e];const t=this.getPlannedEventsInInterval(this.lastActualBalanceDate,e).reduce(((e,t)=>e+(t.credit-t.debit)),this.lastActualBalance);return this.cachedPlannedBalance[e]=t,t}getPlannedBalanceChange(e){return this.getPlannedEvents(e).reduce(((e,t)=>e+(t.credit-t.debit)),0)}prepareToStorage(){const e=this.completed.map((e=>{const t={};return t.name=e.name,e.comment&&(t.comment=e.comment),t.start=s(e.start),t.end=s(e.end),e.credit&&(t.credit=e.credit),e.debit&&(t.debit=e.debit),t})),t=this.plannedRepeatable.reduce(((e,t)=>{const a={};return a.name=t.name,t.comment&&(a.comment=t.comment),a.repeat=t.repeat,a.start=s(t.repeatStart),a.duration=t.duration,t.repeatEnd&&(a.repeatEnd=s(t.repeatEnd)),t.credit&&(a.credit=t.credit),t.debit&&(a.debit=t.debit),e.push(a),e}),[]);return this.planned.reduce(((e,t)=>{const a={};return a.name=t.name,t.comment&&(a.comment=t.comment),a.start=s(t.start),a.end=s(t.end),t.credit&&(a.credit=t.credit),t.debit&&(a.debit=t.debit),e.push(a),e}),t),{completedList:e,plannedList:t}}}(l,d);function o({title:e="Modal title",isOpen:t=!1,onSubmit:a=(()=>{}),onCancel:n=(()=>{}),children:c=null}){return t&&React.createElement("div",{className:"modalOverlay_faa7164",onClick:n},React.createElement("div",{className:"modalWindow_fac41c2",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"modalHeader_ec3e5fe"},React.createElement("div",{className:"modalTitle_e276bb7"},e)),React.createElement("div",{className:"modalBody_a8134eb"},c),React.createElement("div",{className:"modalFooter_dcf803f"},React.createElement("span",{className:"cancel_b0d96c0",onClick:n},"Cancel"),React.createElement("span",{className:"apply_dc7f5d7",onClick:a},"Apply"))))}function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},u.apply(this,arguments)}function p({active:e=!1,disabled:t=!1,children:a="Button",...n}){return React.createElement("span",u({className:"button_c0afaa2 "+(e?"active_b40adfc":"")},n),a)}const g="comment_df4a5f8",h="datetime_b692b08",E="parameter_dcc1064";function y({event:t}){const[a,n]=React.useState(t.repeat&&""!=t.repeat);return console.log("event",t),React.createElement("form",{className:"event_form_e576b51"},React.createElement("div",{className:"name_c4b14a4",contentEditable:"true",suppressContentEditableWarning:!0},t.name??""),React.createElement("label",null,"comment:"),React.createElement("div",{className:g,contentEditable:"true",suppressContentEditableWarning:!0},t.comment??""),React.createElement("div",null,"start date:"),React.createElement("input",{type:"date",className:h,defaultValue:e.getYYYYMMDD(t.repeat?t.repeatStart:t.start??0)}),React.createElement("div",{className:"row_c3cffbc"},React.createElement("div",{className:E},React.createElement("div",null,"time:"),React.createElement("input",{type:"time",className:h,defaultValue:e.getHHMM(t.repeat?t.repeatStart:t.start??0)}))," ",React.createElement("div",{className:E},React.createElement("div",null,"duration:"),React.createElement("input",{type:"time",className:h,defaultValue:""}))),React.createElement("div",null,"end date:"),React.createElement("input",{type:"date",className:h,defaultValue:e.getYYYYMMDD(t.repeat?t.repeatStart:t.start??0)}),React.createElement("div",null,"repeat:"),React.createElement("input",{type:"checkbox",value:"repeat",checked:a,onChange:e=>n((e=>!e))}),a&&React.createElement("div",{className:g,contentEditable:"true",suppressContentEditableWarning:!0},t.repeat),React.createElement("div",null,"credit:"),React.createElement("div",{className:g,contentEditable:"true",suppressContentEditableWarning:!0},t.credit),React.createElement("div",null,"debit:"),React.createElement("div",{className:g,contentEditable:"true",suppressContentEditableWarning:!0},t.debit))}function D({children:c=null}){const[r,s]=React.useState(!1),[i,l]=React.useState(4),d=React.useRef(null),u=React.useRef(null),[g,h]=React.useState({title:"Add new event",name:"New event"});let E=e.getBegintWeekTimestamp(Date.now()/1e3);const D=E;E-=7*i*86400,React.useEffect((()=>{l(6),d.current.scrollTop=604}),[]);const v=[];for(let e=0;e<=20;e++){v.push([]);let t=[];for(let a=0;a<=6;a++)v[e].push([]),v[e][a]={timestamp:E,tasks:m.getEventsWithPlaceholders(E,t),actualBalance:m.getActualBalance(E),plannedBalance:m.getPlannedBalance(E),plannedBalanceChange:m.getPlannedBalanceChange(E)},E+=86400}const f=React.useCallback(((e,t)=>{""!==t&&(h({title:"Add new event",name:t,start:e}),s(!0))})),b=React.useCallback(((e,t)=>{const a=(t?m.completed.find((t=>t.id===e)):m.planned.find((t=>t.id===e)))??m.plannedRepeatable.find((t=>t.id===e));h({...a,title:"Event"}),s(!0)}));return console.log("draw calendar"),React.createElement("div",{className:"wrapper_af90f78"},React.createElement("div",{className:"header_e3daf93"},React.createElement(p,{onClick:e=>{console.log(JSON.stringify(m.prepareToStorage()))}},"Save to LocalStorage"),React.createElement(p,null,"Today"),React.createElement("span",{ref:u,className:"monthTitle_a8c3ab6"})),React.createElement("div",{className:"dayOfWeekLabels_cf63ad3"},e.WEEKDAYS.map(((e,t)=>React.createElement("div",{key:t},e)))),React.createElement("div",{className:"CalendarBody_b3637e9",onScroll:t=>{const a=t.target,n=a.scrollTop,c=a.scrollHeight-a.scrollTop-a.clientHeight,r=Math.ceil(n/151-i),s=new Date(1e3*(D+7*r*86400));u.current.innerText=s.getFullYear()+" "+e.MONTHS_FULL[s.getMonth()]+" "+r+" week",n<600?l((e=>e+4)):c<600&&l((e=>e-4))},ref:d},React.createElement("div",{className:"Scrolled_ce022ef"}," ",v.map((c=>React.createElement("div",{className:"CalendarWeek_ef509bf",key:c[0].timestamp}," ",c.map(((c,r)=>React.createElement(t,{timestamp:c.timestamp,dayHeight:150,key:c.timestamp,actualBalance:c.actualBalance,plannedBalance:c.plannedBalance,plannedBalanceChange:c.plannedBalanceChange,onAddEvent:f},c.tasks.map(((t,c)=>{return-1===t.id?React.createElement(n,{key:c}):React.createElement(a,{id:t.id,key:c,name:t.name,time:e.getTime(t.start),days:(s=t.days,i=7-r,s<i?s:i),completed:t.completed,onClick:b});var s,i})))))))))),React.createElement(o,{title:g.title,isOpen:r,onCancel:()=>s(!1)},React.createElement(y,{event:g})))}function v(){return React.createElement(D,null)}ReactDOM.render(React.createElement(v,null),document.getElementById("root"))})();