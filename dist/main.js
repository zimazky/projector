(()=>{"use strict";class e{static WEEKDAYS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];static MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];static startWeek=1;static timezone=3;static initLocale(t=3,a=1){e.timezone=t,e.startWeek=a}static getDayMonthWeekday(e){const t=new Date(1e3*e);return{day:t.getDate(),month:t.getMonth(),weekday:t.getDay()}}static getWeekday(e){return new Date(1e3*e).getDay()}static getBegintWeekTimestamp(t){const a=new Date(1e3*t);a.setHours(0,0,0,0);const n=a.getDate();let c=a.getDay()-e.startWeek;return c<0&&(c+=7),a.setDate(n-c)/1e3}static getBeginDayTimestamp=t=>86400*~~((t+3600*e.timezone)/86400)-3600*e.timezone;static getEndDayTimestamp=t=>86400*~~((t+3600*e.timezone)/86400)-3600*e.timezone+86400;static getTime=t=>(t+3600*e.timezone)%86400-3600*e.timezone;static getTimeToEndDay=t=>86400-e.getTime(t);static getDifferenceInDays=(t,a)=>(e.getBeginDayTimestamp(a)-e.getBeginDayTimestamp(t))/86400;static getTimeString(e){const t=new Date(1e3*e),a=t.getHours(),n=t.getMinutes();return a+(n>9?":":":0")+n}}function t({timestamp:t,dayHeight:a,actualBalance:n,plannedBalance:c,onAddEvent:r=(()=>{}),children:i=null}){const s=React.useRef(null),{day:l,month:d}=e.getDayMonthWeekday(t);return React.createElement("div",{className:"CalendarDay_afb7130",style:{height:a},onClick:function(e){s&&s.current.focus()}},React.createElement("div",{className:"CalendarDayHeader_ce37fdc"},l+(1==l?" "+e.MONTHS[d]:"")),React.createElement("div",null,n),React.createElement("div",null,c),React.createElement("div",{className:"CalendarDayTasks"}," ",i," "),React.createElement("div",{className:"DayTaskInput_c3fce47"},React.createElement("input",{ref:s,rows:1,wrap:"off",onBlur:function(e){r(t,e.target.value),e.target.value=""},onKeyDown:function(e){13===e.keyCode&&e.target.blur()}})))}function a({name:t,days:a,time:n=0}){return React.createElement("div",{className:"EventItem_b1f2ae7",style:{width:1==a?"calc(100% + 1px)":"calc("+a+" * (100% + 1px) + 1px )"}},React.createElement("span",null,t),React.createElement("span",{className:"EventTime_f0aa565"},e.getTimeString(n)))}function n(){return React.createElement("div",{className:"EventPlaceholder_b109d15"})}function c(e,t,a=31,n=1){const[c,r=null]=t.split("-",2);if(null===r){const[c,r=null]=t.split("/",2);if(""===c||""===r)return e;const i="*"===c?n:+c;let s=+r;if(isNaN(i)||isNaN(s))return e;if(null===r&&"*"!==c)return e.push(+c),e;0===s&&(s=1);for(let t=i;t<=a;t+=s)e.push(t);return e}if(""===c||""===r)return e;for(let t=+c;t<=+r;t++)e.push(t);return e}class r{static getStartDay=t=>e.getBeginDayTimestamp(t.start);static getStartTime=t=>e.getTime(t.start);static getEnd=t=>void 0!==t.end?t.end:void 0!==t.duration?t.start+60*t.duration:e.getEndDayTimestamp(t.start);static getEndDayOfEnd=t=>e.getEndDayTimestamp(r.getEnd(t));static getDuration=t=>void 0!==t.end?t.end-t.start:void 0!==t.duration?60*t.duration:e.getTimeToEndDay(t.start);static getDurationInDays=t=>{const a=void 0!==t.end?(e.getEndDayTimestamp(t.end)-e.getBeginDayTimestamp(t.start))/86400:void 0!==t.duration?(e.getEndDayTimestamp(t.start+60*t.duration)-e.getBeginDayTimestamp(t.start))/86400:1;return Math.ceil(a)};static isRepeatable=e=>void 0!==e.repeat;static isIncludes=(e,t)=>t>=r.getStartDay(e)&&t<r.getEndDayOfEnd(e);static toPlannedEventItem=(e,t,a)=>({id:e,name:t.name,time:r.getStartTime(t),days:a,debit:t.debit??0,credit:t.credit??0});static toActualEventItem=(e,t,a)=>({id:e,name:t.name,time:r.getStartTime(t),days:a,debit:t.debit??0,credit:t.credit??0})}const i=[{name:"НО +30000",credit:{account:1,amount:3e4},comment:"начальный остаток",start:new Date("2022-01-01 00:00")/1e3,balance:52683}],s=[{name:"ЗП +40020",credit:40020,repeat:"10,25 * *",start:new Date("2021-12-01 10:00")/1e3,duration:20},{name:"пенсия мамы",credit:31e3,repeat:"17",start:new Date("2021-12-01 09:00")/1e3,duration:20},{name:"заправка",debit:2500,repeat:"/6",start:new Date("2022-01-12 15:00")/1e3,duration:30},{name:"купить продукты",debit:8e3,repeat:"* * 0",start:new Date("2022-01-04 15:00")/1e3,duration:80},{name:"маму на укол",debit:4e4,start:new Date("2022-02-05 10:00")/1e3,duration:80},{name:"праздники",cost:0,start:new Date("2021-12-31 00:00")/1e3,end:new Date("2022-01-09 23:59")/1e3},{name:"test",cost:0,start:new Date("2022-01-14 14:00")/1e3,duration:2039},{name:"отпуск",cost:0,start:new Date("2022-01-07 00:00")/1e3,duration:20159}];function l(t,a,n=[],l=!1){for(;n.length>0&&!(a<n[n.length-1].end);)n.pop();n.forEach((e=>{t.push({id:-1})}));const d=s.reduce(((t,i,s)=>{if(i.repeat)return a<i.start||i.repeatEnd&&a+e.getTime(i.start)>i.repeatEnd||class{static isMatch(t,a,n){const{day:r,month:i,weekday:s}=e.getDayMonthWeekday(n),[l=null,d="*",m="*"]=t.trim().split(" ",3);if(null===l)return!1;if("/"===l[0]){const t=~~((n-e.getBeginDayTimestamp(a))/86400);return!(t<0)&&t%+l.substring(1)==0}const o=l.split(",").reduce(((e,t)=>c(e,t)),[]),u=d.split(",").reduce(((e,t)=>c(e,t,12)),[]),g=m.split(",").reduce(((e,t)=>c(e,t,7,0)),[]);return!!(u.includes(i+1)&&o.includes(r)&&g.includes(s))}}.isMatch(i.repeat,i.start,a)&&t.push(r.toPlannedEventItem(s,i,1)),t;if(a<r.getStartDay(i))return t;const l=r.getEndDayOfEnd(i);if(a>=l)return t;if(r.getDurationInDays(i)>1){if(n.filter((e=>s==e.id)).length>0)return t;n.push({id:s,end:l})}return t.push(r.toPlannedEventItem(s,i,e.getDifferenceInDays(a,l))),t}),t);return l&&i.reduce(((t,n,c)=>(n.start&&e.getBeginDayTimestamp(n.start)<=a&&e.getEndDayTimestamp(n.start)>a&&t.push(r.toActualEventItem(c,n,1)),t)),d),d}function d(e){const t=i.filter((t=>t.start<e));return 0==t.length?0:t.slice(-1)[0].balance}function m(t){let a=i[i.length-1].start,n=i[i.length-1].balance;t<a&&(a=t,n=0);const c=[],r=[];for(let n=e.getBeginDayTimestamp(a);n<t;n+=86400)l(c,n,r);return c.reduce(((e,t)=>e+((t.credit?t.credit:0)-(t.debit?t.debit:0))),n)}function o({title:e="Modal title",isOpen:t=!1,onSubmit:a=(()=>{}),onCancel:n=(()=>{}),children:c=null}){return t&&React.createElement("div",{className:"modalOverlay_faa7164",onClick:n},React.createElement("div",{className:"modalWindow_fac41c2",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"modalHeader_ec3e5fe"},React.createElement("div",{className:"modalTitle_e276bb7"},e)),React.createElement("div",{className:"modalBody_a8134eb"},c),React.createElement("div",{className:"modalFooter_dcf803f"},React.createElement("span",{className:"cancel_b0d96c0",onClick:n},"Cancel"),React.createElement("span",{className:"apply_dc7f5d7",onClick:a},"Apply"))))}function u({children:c=null}){const[u,g]=React.useState(!1),[p,y]=React.useState(2),f=React.useRef(null);i.sort(((e,t)=>e.start-t.start)),s.sort(((e,t)=>{if(e.repeat)return t.repeat?r.getStartTime(e)-r.getStartTime(t):1;if(t.repeat)return-1;const a=r.getStartDay(e)-r.getStartDay(t);return 0!=a?a:r.getDurationInDays(t)-r.getDurationInDays(e)})),s.forEach((t=>console.log(t.name,e.getTime(t.start))));let D=e.getBegintWeekTimestamp(Date.now()/1e3);D-=7*p*86400,React.useEffect((()=>{y(2),f.current.scrollTop=303}),[]);const E=[];for(let e=0;e<=12;e++){E.push([]);let t=[];for(let a=0;a<=6;a++)E[e].push([]),E[e][a]={timestamp:D,tasks:l([],D,t,!0),actualBalance:d(D),plannedBalance:m(D)},D+=86400}const v=React.useCallback(((e,t)=>{""!==t&&(console.log("Add Event",e,t),g(!0))}));return console.log("draw calendar"),React.createElement("div",{className:"wrapper_af90f78"},React.createElement("div",{className:"dayOfWeekLabels_cf63ad3"},e.WEEKDAYS.map(((e,t)=>React.createElement("div",{key:t},e)))),React.createElement("div",{className:"CalendarBody_b3637e9",onScroll:e=>{const t=e.target,a=t.scrollTop,n=t.scrollHeight-t.scrollTop-t.clientHeight;a<300?y((e=>e+2)):n<300&&y((e=>e-2)),console.log(a,n)},ref:f},React.createElement("div",{className:"Scrolled_ce022ef"}," ",E.map((e=>React.createElement("div",{className:"CalendarWeek_ef509bf",key:e[0].timestamp}," ",e.map(((e,c)=>React.createElement(t,{timestamp:e.timestamp,dayHeight:150,key:e.timestamp,actualBalance:e.actualBalance,plannedBalance:e.plannedBalance,onAddEvent:v},e.tasks.map(((e,t)=>{return-1===e.id?React.createElement(n,{key:t}):React.createElement(a,{key:t,name:e.name,time:e.time,days:(r=e.days,i=7-c,r<i?r:i)});var r,i})))))))))),React.createElement(o,{title:"Add event",isOpen:u,onCancel:()=>g(!1)}))}function g(){return React.createElement(u,null)}ReactDOM.render(React.createElement(g,null),document.getElementById("root"))})();