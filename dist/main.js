(()=>{"use strict";class e{static WEEKDAYS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];static MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];static startWeek=1;static timezone=3;static initLocale(t=3,a=1){e.timezone=t,e.startWeek=a}static getDayMonthWeekday(e){const t=new Date(1e3*e);return{day:t.getDate(),month:t.getMonth(),weekday:t.getDay()}}static getWeekday(e){return new Date(1e3*e).getDay()}static getBegintWeekTimestamp(t){const a=new Date(1e3*t);a.setHours(0,0,0,0);const n=a.getDate();let s=a.getDay()-e.startWeek;return s<0&&(s+=7),a.setDate(n-s)/1e3}static getBeginDayTimestamp(e){return new Date(1e3*e).setHours(0,0,0,0)/1e3}static getEndDayTimestamp(e){return new Date(1e3*e).setHours(0,0,0,0)/1e3+86399}static getTime(t){return(t+3600*e.timezone)%86400-3600*e.timezone}static getTimeString(e){const t=new Date(1e3*e),a=t.getHours(),n=t.getMinutes();return(a>9?"":"0")+a+(n>9?":":":0")+n}}function t({timestamp:t,dayHeight:a,balance:n,children:s=null}){const{day:r,month:c}=e.getDayMonthWeekday(t);return React.createElement("div",{className:"CalendarDay_afb7130",style:{height:a}},React.createElement("div",{className:"CalendarDayHeader_ce37fdc"},r+(1==r?" "+e.MONTHS[c]:"")),React.createElement("div",null,n),React.createElement("div",{className:"CalendarDayTasks"}," ",s," "),React.createElement("div",{className:"DayTaskInput_c3fce47"},React.createElement("textarea",{rows:1,wrap:"off"})))}function a({name:t,days:a,time:n=0}){return React.createElement("div",{className:"EventItem_b1f2ae7",style:{width:"calc("+a+" * (100% + 1px) + 1px)"}},React.createElement("span",null,t),React.createElement("span",{className:"EventTime_f0aa565"},e.getTimeString(n)))}function n(){return React.createElement("div",{className:"EventPlaceholder_b109d15"})}function s(e,t,a=31,n=1){const[s,r=null]=t.split("-",2);if(null===r){const[s,r=null]=t.split("/",2);if(""===s||""===r)return e;const c="*"===s?n:+s;let i=+r;if(isNaN(c)||isNaN(i))return e;if(null===r&&"*"!==s)return e.push(+s),e;0===i&&(i=1);for(let t=c;t<=a;t+=i)e.push(t);return e}if(""===s||""===r)return e;for(let t=+s;t<=+r;t++)e.push(t);return e}const r=[{name:"НО +30000",value:3e4,comment:"начальный остаток",start:new Date("2021-11-15 10:00")/1e3,balance:3e4},{name:"Дорога на дачу",value:2450,start:new Date("2021-11-05 09:00")/1e3,duration:150,balance:29e3}],c=[{name:"ЗП +40020",income:40020,repeat:"10,25 * *",start:new Date("2021-11-01 10:00")/1e3,duration:0},{name:"заправка",repeat:"/6",start:new Date("2021-11-01 15:00")/1e3,duration:0},{name:"четные",repeat:"2/2",start:new Date("2021-11-01 01:00")/1e3,duration:0},{name:"комплексные",repeat:"1/3,20-25",start:new Date("2021-11-01 01:00")/1e3,duration:0},{name:"дорога на работу",cost:0,repeat:"* * 1-5",start:new Date("2021-11-01 08:00")/1e3,duration:60},{name:"работа",cost:0,repeat:"* * 1-5",start:new Date("2021-11-01 09:00")/1e3,duration:540},{name:"праздники",cost:0,start:new Date("2021-12-31 00:00")/1e3,end:new Date("2022-01-26 23:59")/1e3},{name:"test",cost:0,start:new Date("2022-01-14 14:00")/1e3,duration:1439},{name:"отпуск",cost:0,start:new Date("2022-01-14 00:00")/1e3,duration:20159}];function i(t,a,n=86400){const s=a??t+n;return(e.getBeginDayTimestamp(s)-e.getBeginDayTimestamp(t))/86400}function l(e){const t=r.filter((t=>t.start<e));return 0==t.length?0:t.slice(-1)[0].balance}function m(t,a,n=[],l=a+86399){for(;n.length>0&&!(a<e.getEndDayTimestamp(n[n.length-1].end));)n.pop();n.forEach((e=>{t.push({id:-1})}));const m=c.reduce(((t,r,c)=>{if(r.repeat&&a>=r.start)(!r.repeatEnd||a<r.repeatEnd)&&class{static isMatch(t,a,n){const{day:r,month:c,weekday:i}=e.getDayMonthWeekday(n),[l=null,m="*",o="*"]=t.trim().split(" ",3);if(null===l)return!1;if("/"===l[0]){const t=~~((n-e.getBeginDayTimestamp(a))/86400);return!(t<0)&&t%+l.substring(1)==0}const u=l.split(",").reduce(((e,t)=>s(e,t)),[]),d=m.split(",").reduce(((e,t)=>s(e,t,12)),[]),p=o.split(",").reduce(((e,t)=>s(e,t,7,0)),[]);return!!(d.includes(c+1)&&u.includes(r)&&p.includes(i))}}.isMatch(r.repeat,r.start,a)&&t.push({id:c,name:r.name,time:e.getTime(r.start),days:1,income:r.income||0,cost:r.cost||0});else if(r.start&&a>=e.getBeginDayTimestamp(r.start)){const s=e.getEndDayTimestamp(r.end??(r.duration?r.start+60*r.duration:r.start));if(a<s){if(i(r.start,s)>0){if(n.filter((e=>c==e.id)).length>0)return t;n.push({id:c,end:s})}t.push({id:c,name:r.name,time:e.getTime(r.start),days:i(a,Math.min(s,l))+1,income:r.income||0,cost:r.cost||0})}}return t}),t);return r.reduce(((t,n,s)=>(n.start&&e.getBeginDayTimestamp(n.start)<=a&&e.getEndDayTimestamp(n.start)>a&&t.push({id:s,name:"ВЫП "+n.name,time:e.getTime(n.start),days:1,income:n.income||0,cost:n.cost||0}),t)),m),m}const o=150;function u({children:s=null}){const[u,d]=React.useState(0),p=React.useRef(null);r.sort(((e,t)=>e.start-t.start)),c.sort(((t,a)=>{if(t.repeat)return a.repeat?e.getTime(t.start)-e.getTime(a.start):1;if(a.repeat)return-1;const n=e.getBeginDayTimestamp(t.start)-e.getBeginDayTimestamp(a.start);return 0!=n?n:i(a.start,a.end,60*a.duration)-i(t.start,t.end,60*t.duration)})),c.forEach((t=>console.log(t.name,e.getTime(t.start))));let g=e.getBegintWeekTimestamp(Date.now()/1e3);console.log("scrollHeight",u),g+=604800*(~~(u/o)-1);const y=[];for(let e=0;e<=5;e++){y.push([]);let t=[],a=g+604800-1;for(let n=0;n<=6;n++)y[e].push([]),y[e][n]={timestamp:g,tasks:m([],g,t,a),balance:l(g)},g+=86400}function f(e){e.preventDefault();let t=e.wheelDelta>0?1:-1;console.log(this.style.top);let a=parseInt(this.style.top)+15*t;a>=0?(console.log(a),d((e=>e-o)),a-=o):a<-150&&(console.log(a),d((e=>e+o)),a+=o),this.style.top=a+"px"}return React.useEffect((()=>(console.log("Calendar AddEventListener Mouse"),p.current.addEventListener("wheel",f),()=>{console.log("Calendar RemoveEventListener Mouse"),p.current.removeEventListener("wheel",f)})),[]),console.log("draw calendar"),React.createElement(React.Fragment,null,React.createElement("div",{className:"dayOfWeekLabels_cf63ad3"},e.WEEKDAYS.map(((e,t)=>React.createElement("div",{key:t},e)))),React.createElement("div",{className:"CalendarBody_b3637e9"},React.createElement("div",{className:"Scrolled_ce022ef",style:{top:-150},ref:p}," ",y.map((e=>React.createElement("div",{className:"CalendarWeek_ef509bf",key:e[0].timestamp}," ",e.map((e=>React.createElement(t,{timestamp:e.timestamp,dayHeight:o,balance:e.balance,key:e.timestamp},e.tasks.map(((e,t)=>-1===e.id?React.createElement(n,{key:t}):React.createElement(a,{key:t,name:e.name,time:e.time,days:e.days}))))))))))))}function d(){return React.createElement(u,null)}ReactDOM.render(React.createElement(d,null),document.getElementById("root"))})();