(()=>{"use strict";const e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function a(e){const t=new Date(1e3*e);return{day:t.getDate(),month:t.getMonth(),weekday:t.getDay()}}function n(e,t){const a=t.split("-");if("*"===a[0])return e;if(1==a.length)e.push(+a[0]);else for(let t=+a[0];t<=a[1];t++)e.push(t);return e}function r(e){return new Date(1e3*e).setHours(0,0,0,0)/1e3}function c(e){return new Date(1e3*e).setHours(0,0,0,0)/1e3+86399}function s(e,t,a=86400){return(r(t??e+a)-r(e))/86400}function o({timestamp:e,dayHeight:n,balance:r,children:c=null}){const{day:s,month:o}=a(e);return React.createElement("div",{className:"CalendarDay_afb7130",style:{height:n}},React.createElement("div",{className:"CalendarDayHeader_ce37fdc"},s+(1==s?" "+t[o]:"")),React.createElement("div",null,r),React.createElement("div",{className:"CalendarDayTasks"}," ",c," "),React.createElement("div",{className:"DayTaskInput_c3fce47"},React.createElement("textarea",{rows:1,wrap:"off"})))}function l({name:e,days:t,start:a=""}){return React.createElement("div",{className:"EventItem_b1f2ae7",style:{width:"calc("+t+" * (100% + 1px) + 1px)"}},e+" "+a)}function i(){return React.createElement("div",{className:"EventPlaceholder_b109d15"})}const u=[{name:"НО +30000",type:"initial",value:3e4,comment:"начальный остаток",date:new Date("2021-11-15 10:00")/1e3,balance:3e4},{name:"Дорога на дачу",category:"дача",value:2450,date:new Date("2021-11-05 09:00")/1e3,duration:150,balance:29e3}],d=[{name:"ЗП +40020",category:"earnings",income:40020,repeat:"0 10 10,25 * *",repeatStart:new Date("2021-11-01")/1e3,duration:0},{name:"работа",category:"routine",cost:0,repeat:"0 9 * * 1-5",repeatStart:new Date("2021-11-01 00:00")/1e3,duration:540},{name:"дорога на работу",category:"routine",cost:0,repeat:"30 8,18 * * 1-5",repeatStart:new Date("2021-11-01")/1e3,duration:60},{name:"праздники",category:"holydays",priority:0,cost:0,start:new Date("2021-12-31 00:00")/1e3,end:new Date("2022-01-26 23:59")/1e3},{name:"test",category:"vacation",priority:0,cost:0,start:new Date("2022-01-14 00:00")/1e3,duration:1439},{name:"отпуск",category:"vacation",priority:0,cost:0,start:new Date("2022-01-14 00:00")/1e3,duration:17279}];function m(e){const t=u.filter((t=>t.date<e));return 0==t.length?0:t.slice(-1)[0].balance}function p(e,t,o=[],l=t+86399){for(;o.length>0&&!(t<c(o[o.length-1].end));)o.pop();o.forEach((t=>{e.push({id:-1})}));const i=d.reduce(((e,i,u)=>{if(i.repeatStart&&t>=i.repeatStart){if((!i.repeatEnd||t<i.repeatEnd)&&function(e,t){const{day:r,month:c,weekday:s}=a(e),o=t.split(" "),l=o[2].split(",").reduce(((e,t)=>n(e,t)),[]),i=o[3].split(",").reduce(((e,t)=>n(e,t)),[]),u=o[4].split(",").reduce(((e,t)=>n(e,t)),[]),d=0==s?7:s;return!(0!=i.length&&!i.includes(c)||0!=l.length&&!l.includes(r)||0!=u.length&&!u.includes(d))}(t,i.repeat)){const[t,a]=i.repeat.split(" ");e.push({id:u,name:i.name,days:1,hours:a,minutes:t,income:i.income||0,cost:i.cost||0})}}else if(i.start&&t>=r(i.start)){const a=c(i.end??(i.duration?i.start+60*i.duration:i.start));if(t<a){if(s(i.start,a)>0){if(o.filter((e=>u==e.id)).length>0)return e;o.push({id:u,end:a})}e.push({id:u,name:i.name,days:s(t,Math.min(a,l))+1,hours:0,minutes:0,income:i.income||0,cost:i.cost||0})}}return e}),e);return u.reduce(((e,a,n)=>(a.date&&a.date<=t&&a.date+86400>t&&e.push({id:n,name:"ВЫП "+a.name,days:1,hours:0,minutes:0,income:a.income||0,cost:a.cost||0}),e)),i),i}const f=150;function y({children:t=null}){const[a,n]=React.useState(0),r=React.useRef(null);u.sort(((e,t)=>e.date-t.date)),d.sort(((e,t)=>{if(e.start){if(!t.start)return-1;const a=e.start-t.start;return 0!=a?a:s(t.start,t.end,60*t.duration)-s(e.start,e.end,60*e.duration)}return t.start?1:0}));let c=function(e){const t=new Date(1e3*e);t.setHours(0,0,0,0);const a=t.getDate();let n=t.getDay();return n=0==n?7:n,t.setDate(a-n+1)/1e3}(Date.now()/1e3);console.log("scrollHeight",a),c+=604800*(~~(a/f)-1);const y=[];for(let e=0;e<=5;e++){y.push([]);let t=[],a=c+604800-1;for(let n=0;n<=6;n++)y[e].push([]),y[e][n]={timestamp:c,tasks:p([],c,t,a),balance:m(c)},c+=86400}function h(e){e.preventDefault();let t=e.wheelDelta>0?1:-1;console.log(this.style.top);let a=parseInt(this.style.top)+15*t;a>=0?(console.log(a),n((e=>e-f)),a-=f):a<-150&&(console.log(a),n((e=>e+f)),a+=f),this.style.top=a+"px"}return React.useEffect((()=>(console.log("Calendar AddEventListener Mouse"),r.current.addEventListener("wheel",h),()=>{console.log("Calendar RemoveEventListener Mouse"),r.current.removeEventListener("wheel",h)})),[]),console.log("draw calendar"),React.createElement(React.Fragment,null,React.createElement("div",{className:"dayOfWeekLabels_cf63ad3"},e.map(((e,t)=>React.createElement("div",{key:t},e)))),React.createElement("div",{className:"CalendarBody_b3637e9"},React.createElement("div",{className:"Scrolled_ce022ef",style:{top:-150},ref:r}," ",y.map((e=>React.createElement("div",{className:"CalendarWeek_ef509bf",key:e[0].timestamp}," ",e.map((e=>React.createElement(o,{timestamp:e.timestamp,dayHeight:f,balance:e.balance,key:e.timestamp},e.tasks.map(((e,t)=>-1===e.id?React.createElement(i,{key:t}):React.createElement(l,{key:t,name:e.name+" "+e.hours+":"+e.minutes,days:e.days}))))))))))))}function h(){return React.createElement(y,null)}ReactDOM.render(React.createElement(h,null),document.getElementById("root"))})();